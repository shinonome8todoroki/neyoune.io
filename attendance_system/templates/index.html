{% extends "bootstrap/base.html" %}
{% block title %}ç¡çœ è¨˜éŒ²{% endblock %}

{% block content %}
<div class="container">
    <h1>ä»Šæ—¥ã®è¨˜éŒ²</h1>

    <!-- ã€Œã¿ã‚“ãªã®è¨˜éŒ²ã€ã€Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€ã€Œãƒ­ã‚°ã‚¢ã‚¦ãƒˆã€ãƒœã‚¿ãƒ³ -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <div></div>
        <div>
            <a href="{{ url_for('all_records') }}" class="btn btn-secondary">ã¿ã‚“ãªã®è¨˜éŒ²</a>
            <a href="{{ url_for('calendar_view') }}" class="btn btn-secondary">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a>
            <a href="{{ url_for('logout') }}" class="btn btn-secondary">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ  -->
    <h3>æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹</h3>

    <form method="post" action="{{ url_for('record') }}">
        <h4>è¡Œå‹•</h4>
        <div class="form-group">
            <select name="action" id="action" class="form-control">
                <option value="wake_up">èµ·åºŠ</option>
                <option value="sleep">å°±å¯</option>
                <option value="other">ãã®ä»–</option>
            </select>
        </div>

        <h4>ãƒ¡ãƒ¢ (ä»»æ„)</h4>
        <div class="form-group">
            <input type="text" name="memo" id="memo" class="form-control">
        </div>

        <!-- ãƒœã‚¿ãƒ³ -->
        <button type="submit" class="btn btn-success">è¨˜éŒ²ã™ã‚‹</button>
    </form>

    <!-- å…¬é–‹/éå…¬é–‹åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ -->
    <div class="d-flex justify-content-between align-items-center mt-3">
        <h2></h2>
        <form method="post" action="{{ url_for('toggle_privacy') }}">
            <label class="switch">
                <input type="checkbox" name="is_private" {% if is_private %}checked{% endif %} onchange="this.form.submit()">
                <span class="slider round"></span>
            </label>
            <small>éå…¬é–‹ãƒ¢ãƒ¼ãƒ‰</small>
        </form>
    </div>

    <!-- ä»Šæ—¥ã®è¨˜éŒ²ä¸€è¦§ -->
    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>æ™‚é–“</th>
                <th>è¡Œå‹•</th>
                <th>ãƒ¡ãƒ¢</th>
                <th>åå¿œ</th>
                <th>å‰Šé™¤</th>
            </tr>
        </thead>
        <tbody>
            {% if records %}
                {% for record in records %}
                    <tr>
                        <!-- æ™‚é–“è¡¨ç¤ºã‚’ç§’ã¾ã§å«ã‚ã‚‹ -->
                        <td>
                            {% if record.timestamp %}
                                {% if isinstance(record.timestamp, str) %}
                                    {{ record.timestamp }}
                                {% else %}
                                    {{ record.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
                                {% endif %}
                            {% endif %}
                        </td>
                        <!-- è¡Œå‹•è¡¨ç¤º -->
                        <td>{% if record.action == 'wake_up' %} èµ·åºŠ {% elif record.action == 'sleep' %} å°±å¯ {% else %} {{ record.action }} {% endif %}</td>

                        <!-- ãƒ¡ãƒ¢ -->
                        <td>{{ record.memo if record.memo else '---' }}</td>

                        <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ -->
                        <td><form action="{{ url_for('like_record', record_id=record.id, from_page='index') }}" method="post"><button type="submit" class="btn btn-sm btn-primary">ğŸ‘ {{ record.likes_count }}</button></form></td>

                        <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                        <td><form action="{{ url_for('delete_record', record_id=record.id) }}" method="post"><button type="submit" class="btn btn-sm btn-danger">å‰Šé™¤</button></form></td>

                    </tr>
                {% endfor %}
            {% else %}
                <!-- è¨˜éŒ²ãŒãªã„å ´åˆ -->
                <tr><td colspan='5'>ä»Šæ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>
            {% endif %}
        </tbody>
    </table>

</div>
{% endblock %}
