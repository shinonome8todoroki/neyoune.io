{% extends "bootstrap/base.html" %}
{% block title %}ç¡çœ è¨˜éŒ²{% endblock %}

{% block content %}
<div class="container">
    <h1>ä»Šæ—¥ã®è¨˜éŒ²</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}" role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>æ™‚é–“</th>
                <th>è¡Œå‹•</th>
                <th>ãƒ¡ãƒ¢</th>
                <th>åå¿œ</th>
                <th>å‰Šé™¤</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
            <tr>
                <td>
                    {% if record.timestamp %}
                        {% if isinstance(record.timestamp, str) %}
                            {{ record.timestamp }}
                        {% else %}
                            {{ record.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
                        {% endif %}
                    {% endif %}
                </td>
                <td>
                    {% if record.action == 'wake_up' %}
                        èµ·åºŠ
                    {% elif record.action == 'sleep' %}
                        å°±å¯
                    {% else %}
                        {{ record.action }}
                    {% endif %}
                </td>
                <td>{{ record.memo if record.memo else '---' }}</td>
                <td>{{ record.likes_count }}</td>
                <td>
                    <form action="{{ url_for('delete_record', record_id=record.id) }}" method="post">
                        <button type="submit" class="btn btn-danger btn-sm">å‰Šé™¤</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- æ–°ã—ã„è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <h3>æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹</h3>

    <form method="post" action="{{ url_for('record') }}">
        <div class="form-group">
            <label for="action">è¡Œå‹•:</label>
            <select id="action" name="action" class="form-control">
                <option value="wake_up">èµ·åºŠ</option>
                <option value="sleep">å°±å¯</option>
                <option value="other">ãã®ä»–</option>
            </select>
        </div>
        <div class="form-group">
            <label for="memo">ãƒ¡ãƒ¢:</label>
            <input type="text" id="memo" name="memo" class="form-control">
        </div>
        <button type="submit" class="btn btn-primary">è¨˜éŒ²ã™ã‚‹</button>
    </form>

</div>

<!-- å…¬é–‹/éå…¬é–‹åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ -->
<div class="d-flex justify-content-between align-items-center mt-3">
    <h2>ä»Šæ—¥ã®è¨˜éŒ²</h2>
    <table class="table table-bordered mt-4">
    </table>
    <!-- ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¹ã‚¤ãƒƒãƒ -->
    <form method="post" action="{{ url_for('toggle_privacy') }}">
        <label class="switch">
            <input type="checkbox" name="is_private" {% if is_private %}checked{% endif %} onchange="this.form.submit()">
            <span class="slider round"></span>
        </label>
        <small>éå…¬é–‹ãƒ¢ãƒ¼ãƒ‰</small>
    </form>
</div>

<!-- æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ  -->
<h3>æ–°ã—ã„è¨˜éŒ²ã‚’è¿½åŠ ã™ã‚‹</h3>

<form method="post" action="{{ url_for('record') }}">
    <div class="form-group">
        <label for="action">è¡Œå‹•:</label><br/>
        <select name="action" id="action" class="form-control">
            <option value="wake_up">èµ·åºŠ</option>
            <option value="sleep">å°±å¯</option>
        </select><br/>
    </div>

    <div class="form-group">
        <label for="memo">ãƒ¡ãƒ¢ (ä»»æ„):</label><br/>
        <input type="text" name="memo" id="memo" class="form-control"><br/>
    </div>

    <!-- ãƒœã‚¿ãƒ³ -->
    <button type="submit" class="btn btn-success">è¨˜éŒ²ã™ã‚‹</button>
</form>

<!-- ä»Šæ—¥ã®è¨˜éŒ²ä¸€è¦§ -->
<table class="table table-bordered mt-4">
    <thead>
        <tr>
            <th>æ™‚é–“</th>
            <th>è¡Œå‹•</th>
            <th>ãƒ¡ãƒ¢</th>
            <th>åå¿œ</th>
            <th>å‰Šé™¤</th>
        </tr>
    </thead>
    <tbody>
        {% if records %}
            {% for record in records %}
                <tr>
                    <!-- æ™‚é–“è¡¨ç¤ºã‚’ç§’ã¾ã§å«ã‚ã‚‹ -->
                    <td>{{ record.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                    <!-- è¡Œå‹•è¡¨ç¤º -->
                    <td>{% if record.action == 'wake_up' %} èµ·åºŠ {% elif record.action == 'sleep' %} å°±å¯ {% else %} {{ record.action }} {% endif %}</td>

                    <!-- ãƒ¡ãƒ¢ -->
                    <td>{{ record.memo if record.memo else '---' }}</td>

                    <!-- ã„ã„ã­ãƒœã‚¿ãƒ³ -->
                    <td><form action="{{ url_for('like_record', record_id=record.id, from_page='index') }}" method="post"><button type="submit" class="btn btn-sm btn-primary">ğŸ‘ {{ record.likes_count }}</button></form></td>

                    <!-- å‰Šé™¤ãƒœã‚¿ãƒ³ -->
                    <td><form action="{{ url_for('delete_record', record_id=record.id) }}" method="post"><button type="submit" class="btn btn-sm btn-danger">å‰Šé™¤</button></form></td>

                </tr>
            {% endfor %}
        {% else %}
            <!-- è¨˜éŒ²ãŒãªã„å ´åˆ -->
            <tr><td colspan='5'>ä»Šæ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>
        {% endif %}
    </tbody>
</table>

<style>

/* ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¹ã‚¤ãƒƒãƒç”¨CSS */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top:0; left:0; right:0; bottom:0;
  background-color:#ccc; transition:.4s; border-radius:34px;
}

.slider::before {
  position:absolute; content:"";
  height:26px;width:26px; left:4px; bottom:4px;
  background-color:white; transition:.4s; border-radius:50%;
}

input:checked + .slider { background-color:#2196F3; }
input:checked + .slider::before { transform: translateX(26px); }

</style>

{% endblock %}
